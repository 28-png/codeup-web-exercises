<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <title>Weather Map</title>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet'>
</head>
<body class="m-3 bg-info">

<h1>Weather Info</h1>

<div class="d-flex justify-content-center">
<div class="card bg-light" style="width: 18rem; height: 23vw">
    <div class="card-body">
       <div id="renderContent"></div>
    </div>
</div>
    <div class="d-flex justify-content-center">
        <div class="card bg-light" style="width: 18rem; height: 23vw">
    <div class="card-body">
        <div id="renderContent2"></div>
    </div>
    </div>
        <div class="card bg-light" style="width: 18rem; height: 23vw">
        <div class="card-body">
           <div id="renderContent3"></div>
        </div>
        </div>
    </div>
    </div>

<div id='map' class="mt-3" style='width: 1233px; height: 500px;'></div>

<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<script src="js/jQuery-2.2.4.js"></script>
<script src="js/keys.js"></script>
<script>



    $.ajax("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkies + "/29.4241,-98.4936"
    ).done(function(weather) {
        console.log(weather);
        var iconKeys = {
            snow: "img/climacons-master/SVG/Snowflake.svg",
            rain: "img/climacons-master/SVG/Cloud-Rain.svg",
            clearday: "img/climacons-master/SVG/Sun.svg",
            partlycloudyday: "img/climacons-master/SVG/Cloud-Sun.svg",
            fog: "img/climacons-master/SVG/Cloud-Fog.svg",
            cloudy: "img/climacons-master/SVG/Cloud.svg",
            clearnight: "img/climacons-master/SVG/Moon.svg",
            partlycloudynight: "img/climacons-master/SVG/Cloud-Moon.svg",
            sleet: "img/climacons-master/SVG/Cloud-Snow.svg",
            wind: "img/climacons-master/SVG/Wind.svg"

        };


        Date.prototype.addDays = function(days) {
            var date = new Date(this.valueOf());
            date.setDate(date.getDate() + days);
            return date;
        }

        var date = new Date();


       // first day

       function renderOnPage() {
            var  pendingString = weather.currently.icon;
           var finalString = pendingString.split("-").join("");
           return '<div>' +
               '<h5>' + date.addDays(0).toString().substring(0, 10) + '</h5>' +
               '<h4 class="d-flex justify-content-center">' + weather.currently.temperature + '°'  + '/' + weather.currently.apparentTemperature + '°' + '</h4>' +
                   '<h6>Time Zone: ' + weather.timezone + '</h6>' +
                    '<img src=' + iconKeys[finalString] +  '>' +
                  '<p>Summary: ' + weather.currently.summary + '</p>' +
            '</div>'
       }
            $('#renderContent').append(renderOnPage());


       // second day
       function renderOnPage2() {
        var pendingString = weather.daily.data[1].icon;
        var finalString = pendingString.split("-").join("");
            return '<div>' +
                '<h5>' + date.addDays(1).toString().substring(0, 10) + '</h5>' +
                '<h4 class="d-flex justify-content-center">' + weather.daily.data[1].temperatureLow + '°' + '/' + weather.daily.data[1].temperatureHigh + '°' + '</h4>' +
                '<h6>Time Zone: ' + weather.timezone + '</h6>' +
                    '<img src=' + iconKeys[finalString] + '>' +
               '<p>Summary: ' + weather.daily.data[1].summary + '</p>' +
               '</div>'
        }
        $('#renderContent2').append(renderOnPage2());

        // third day
        function renderOnPage3() {
        var pendingString = weather.daily.data[2].icon;
            var finalString = pendingString.split("-").join("");
            return '<div>' +
                '<h5>' + date.addDays(2).toString().substring(0, 10) + '</h5>' +
                '<h4 class="d-flex justify-content-center">' + weather.daily.data[2].temperatureLow + '°' + '/' + weather.daily.data[2].temperatureHigh + '°' + '</h4>' +
                '<h6>Time Zone: ' + weather.timezone + '</h6>' +
                    '<img src=' + iconKeys[finalString] + '>' +
                '<p>Summary: ' + weather.daily.data[2].summary + '</p>' +
                '</div>'
        }
        $('#renderContent3').append(renderOnPage3())

    });

    mapboxgl.accessToken = mapboxToken;

    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/dark-v10',
        zoom: 11,
        center: [-98.4951, 29.4246]
    });

    var  markerOptions = {
        color: "red",
        rotation: 2
    };

    var marker = new mapboxgl.Marker(markerOptions)
        .setLngLat([-98.4951, 29.4246])
        .addTo(map);

    marker.setPopup()


</script>
</body>
</html>